<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Tetris 3D # The following project applies concepts of visual computing to the classic game of Tetris. The goal is to create a 3D version of the game, where the player can rotate the game board and the falling blocks. The game should be playable with a keyboard. The purpose is to learn about the following topics:
3D transformations Matrix transformations to different coordinate systems Views, and productions of 3D scenes Background # Every transformation in spaces of 2D or 3D can be represented as a matrix."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://visual-computing-2022-2.github.io/Talleres/docs/Workshop/workshop_2/tetris/"><title>Tetris | Visual Computing</title><link rel=manifest href=/Talleres/manifest.json><link rel=icon href=/Talleres/favicon.png type=image/x-icon><link rel=stylesheet href=/Talleres/book.min.4b35fed0bea034bbc19c89c71e14b73fb9c68cfcc586b9382adfb9b7b103ba06.css integrity="sha256-SzX+0L6gNLvBnInHHhS3P7nGjPzFhrk4Kt+5t7EDugY=" crossorigin=anonymous><script defer src=/Talleres/flexsearch.min.js></script>
<script defer src=/Talleres/en.search.min.a4a7569b49f79aff884753eecc7535cb3a0748bedba1fc6426e9b0f84c70ac00.js integrity="sha256-pKdWm0n3mv+IR1PuzHU1yzoHSL7bofxkJumw+ExwrAA=" crossorigin=anonymous></script>
<link rel=alternate type=application/rss+xml href=https://visual-computing-2022-2.github.io/Talleres/docs/Workshop/workshop_2/tetris/index.xml title="Visual Computing"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/Talleres/><span>Visual Computing</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><a href=/Talleres/docs/Workshop/>Workshop</a><ul><li><input type=checkbox id=section-890fdf72107ced932b57ba979e798b88 class=toggle>
<label for=section-890fdf72107ced932b57ba979e798b88 class="flex justify-between"><a role=button>Shaders</a></label><ul><li><a href=/Talleres/docs/Workshop/Shaders/Coloring/>Coloring</a><ul></ul></li><li><a href=/Talleres/docs/Workshop/Shaders/Image_Processing/>Image Processing</a><ul></ul></li><li><a href=/Talleres/docs/Workshop/Shaders/Lighting/>Lighting</a><ul></ul></li><li><a href=/Talleres/docs/Workshop/Shaders/Photomosaic/>Photomosaic</a><ul></ul></li><li><a href=/Talleres/docs/Workshop/Shaders/Spatial_Coherence/>Spatial Coherence</a><ul></ul></li><li><a href=/Talleres/docs/Workshop/Shaders/Textures/>Textures</a><ul></ul></li></ul></li><li><input type=checkbox id=section-8d2b6a08245086db5d9347a14c60b971 class=toggle>
<label for=section-8d2b6a08245086db5d9347a14c60b971 class="flex justify-between"><a href=/Talleres/docs/Workshop/workshop_1/>Workshop 1</a></label><ul><li><a href=/Talleres/docs/Workshop/workshop_1/masking/>Masking</a></li><li><input type=checkbox id=section-2aa212ced681e7ddb472ce2ea2174f76 class=toggle>
<label for=section-2aa212ced681e7ddb472ce2ea2174f76 class="flex justify-between"><a href=/Talleres/docs/Workshop/workshop_1/visual_ilussion/>Visual Ilussion</a></label><ul><li><a href=/Talleres/docs/Workshop/workshop_1/visual_ilussion/frisensLazyShadow/>Frisens Lazy Shadow</a></li><li><a href=/Talleres/docs/Workshop/workshop_1/visual_ilussion/jastrowIllusion/>Jastrow Illusion</a></li><li><a href=/Talleres/docs/Workshop/workshop_1/visual_ilussion/kinegramScanimation/>Kinegram Scanimation</a></li><li><a href=/Talleres/docs/Workshop/workshop_1/visual_ilussion/steppingFeetMotionIllusion/>Stepping Feet Motion Illusion</a></li></ul></li></ul></li><li><input type=checkbox id=section-6f90cee8795c0cd7b85a94bc2603fc3f class=toggle checked>
<label for=section-6f90cee8795c0cd7b85a94bc2603fc3f class="flex justify-between"><a href=/Talleres/docs/Workshop/workshop_2/>Workshop 2</a></label><ul><li><input type=checkbox id=section-673b9b4bfd505a1d2632f367f1a8e21b class=toggle>
<label for=section-673b9b4bfd505a1d2632f367f1a8e21b class="flex justify-between"><a href=/Talleres/docs/Workshop/workshop_2/practice/>Practice</a></label><ul></ul></li><li><input type=checkbox id=section-a1f74c2d4e02c95786884d1e3422628e class=toggle>
<label for=section-a1f74c2d4e02c95786884d1e3422628e class="flex justify-between"><a role=button>Rasterization</a></label><ul><li><a href=/Talleres/docs/Workshop/workshop_2/rasterization/colorShading/>Color Shading</a></li><li><a href=/Talleres/docs/Workshop/workshop_2/rasterization/textureMapping/>Texture Mapping</a></li></ul></li><li><a href=/Talleres/docs/Workshop/workshop_2/tetris/ class=active>Tetris</a><ul></ul></li></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/Talleres/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Tetris</strong>
<label for=toc-control><img src=/Talleres/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#tetris-3d>Tetris 3D</a><ul><li><a href=#background>Background</a></li><li><a href=#the-game>The Game</a></li><li><a href=#implementation-details>Implementation details</a></li><li><a href=#results>Results</a></li><li><a href=#conclusions--future-work>Conclusions & Future Work</a></li><li><a href=#references>References</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=tetris-3d>Tetris 3D
<a class=anchor href=#tetris-3d>#</a></h1><p>The following project applies concepts of visual computing to the classic game of Tetris. The goal is to create a 3D version of the game, where the player can rotate the game board and the falling blocks. The game should be playable with a keyboard. The purpose is to learn about the following topics:</p><ul><li>3D transformations</li><li>Matrix transformations to different coordinate systems</li><li>Views, and productions of 3D scenes</li></ul><iframe id=tetris style=width:780px;height:1000px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js></script>
            <script src=https://cdn.jsdelivr.net/gh/VisualComputing/p5.treegl/p5.treegl.js></script>
            <script src=https://freshfork.github.io/p5.EasyCam/p5.easycam.js></script>
            
            
            
            
            
            <script src=/Talleres/sketches/taller2/tetris.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><h2 id=background>Background
<a class=anchor href=#background>#</a></h2><p>Every transformation in spaces of 2D or 3D can be represented as a matrix. Each matrix will have a different effect on the object. The following table shows the different matrices and their effects.</p><table><thead><tr><th>Matrix</th><th>Effect</th></tr></thead><tbody><tr><td>Translation</td><td>Moves the object in space</td></tr><tr><td>Rotation</td><td>Rotates the object in space</td></tr><tr><td>Scaling</td><td>Scales the object in space</td></tr><tr><td>Shearing</td><td>Shears the object in space</td></tr></tbody></table><p>For a generalization of the transformations, we can use matrix 4x4, to generalize the transformations needed to do affine and linear transformations.</p><p>Thanks to the property of space transformations to be capable to be performed using several matrices multiplications, we can build interesting transformations to many objects on the space changing the reference system, and in the way we apply each transformation continuously.</p><p>In this way, we can get many perspectives of objects and they may perform different actions dependin on the order in our scene trees.</p><p>(see: <a href=https://visualcomputing.github.io/docs/>Homogenous Coordinates, Coordinate Spaces sections</a>.)</p><p>Thanks to different libraries and implementations, as <a href=https://p5js.org/>p5.js</a>, we can easily implement these transformations and get a visual representation of them, using webGL API, for example.</p><p>I this way, we can get interesting and entertaining results, as we will see in the following project, making a 3D version of the classic game of Tetris, changing the perspective of the game board and the falling blocks, and sightly its dynamics.</p><h2 id=the-game>The Game
<a class=anchor href=#the-game>#</a></h2><p>Tetris is a tile-matching puzzle video game, originally designed and programmed by Soviet Russian software engineer Alexey Pajitnov. The first playable version was completed on June 6, 1984, while he was working for the Dorodnitsyn Computing Centre of the Academy of Sciences of the USSR in Moscow. It was officially released on June 6, 1984, and published by the Soviet Union&rsquo;s Academy of Sciences. <a href=https://en.wikipedia.org/wiki/Tetris>Wikipedia</a>.</p><p>The game consists of seven different tetrominoes, each made up of four squares. The tetrominoes fall down the playing field (a rectangular vertical shaft, called the &ldquo;well&rdquo; or &ldquo;matrix&rdquo;). The objective of the game is to manipulate these tetrominoes, by moving each one sideways and rotating it by 90-degree angles, with the aim of creating a horizontal line of ten units without gaps. When such a line is created, it disappears, and any block above the deleted line will fall. The player can proceed to fill the vacated line. The game ends when the stack of tetrominoes reaches the top of the playing field and no new tetrominoes are able to enter. <a href=https://en.wikipedia.org/wiki/Tetris>Wikipedia</a>.</p><p>In this way, we preserve the original game dynamics almost completely, but we will add a new perspective to the game, and we will change the way the blocks fall, and the way the game board is rotated, making the board have no limits on its sides, and the blocks will fall in a more natural way, as if they were falling in a real 3D space.</p><p>As the original game, its memory is conformed by a matrix of 10x20, where the blocks will fall, and the player will be able to move them, and rotate the game board, to make the blocks fit in the matrix, but, as there are no limits on its sides, each tetrominoes can be traslated freely in the X axis. The game will be over when the blocks reach the top of the matrix.</p><h2 id=implementation-details>Implementation details
<a class=anchor href=#implementation-details>#</a></h2><p>For more implementation details, you can check the source code on github, or in the following box:</p><details><summary>Tetris 3D implementation</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>﻿</span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>  Game&#39;s logic:
</span></span></span><span style=display:flex><span><span style=color:#75715e>  We mantain a 2D matrix holding the game&#39;s state 18x18
</span></span></span><span style=display:flex><span><span style=color:#75715e>  This matrix will hold the current box placed in a cell (save the color), or 0 if the cell is empty.
</span></span></span><span style=display:flex><span><span style=color:#75715e>  
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>mod</span>(<span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>m</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> ((<span style=color:#a6e22e>n</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>m</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>m</span>) <span style=color:#f92672>%</span> <span style=color:#a6e22e>m</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gameMatrix</span> <span style=color:#f92672>=</span> Array();
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>WIDTH_GAME_MATRIX</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>18</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>HEIGHT_GAME_MATRIX</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>18</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>width</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>762</span>; <span style=color:#75715e>//Put 800 here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>height</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>972</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>camX</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>camY</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>280</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>camZ</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>centerX</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>centerY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>camY</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>centerZ</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cameraDistance</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>700</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cameraAngleRotation</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>colors</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>tokens</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>  [
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  [
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  [
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>3</span>,],
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>3</span>,]
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  [
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>4</span>],
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>4</span>],
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>4</span>]
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  [
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  [
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>6</span>],
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  [
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>7</span>],
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>step</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>360</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>WIDTH_GAME_MATRIX</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>height_step</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>400</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>HEIGHT_GAME_MATRIX</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>tetrisRadius</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>85</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>interval</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>current_order</span> <span style=color:#f92672>=</span> [...<span style=color:#a6e22e>tokens</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>h_token</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>17</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i_token</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>current_token</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>preload</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>img</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>&#34;/Talleres/sketches/taller2/assets/texture.jpg&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>actual_score</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>high_score</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>score_button_display</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>high_score_button_display</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createCanvas</span>(<span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>height</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>angleMode</span>(<span style=color:#a6e22e>DEGREES</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>frameRate</span>(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>colors</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>1</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>color</span>(<span style=color:#e6db74>&#34;#E0DDDD&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>2</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>color</span>(<span style=color:#e6db74>&#34;#F9DC5C&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>3</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>color</span>(<span style=color:#e6db74>&#34;#98F3F6&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>4</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>color</span>(<span style=color:#e6db74>&#34;#44BA3D&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>5</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>color</span>(<span style=color:#e6db74>&#34;#C08AE9&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>6</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>color</span>(<span style=color:#e6db74>&#34;#F39A9D&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>7</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>color</span>(<span style=color:#e6db74>&#34;#C6ECAE&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>8</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>color</span>(<span style=color:#e6db74>&#34;#FE55E4&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>9</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>color</span>(<span style=color:#e6db74>&#34;#9f9f9f&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>10</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>color</span>(<span style=color:#e6db74>&#34;#FF0034&#34;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;(RE) START&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#34;height&#34;</span>, <span style=color:#e6db74>&#34;100px&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#34;.button-64 {  align-items: center;  background-image: linear-gradient(144deg,#AF40FF, #5B42F3 50%,#00DDEB);  border: 0;  border-radius: 8px;  box-shadow: rgba(151, 65, 252, 0.2) 0 15px 30px -5px;  box-sizing: border-box;  color: #FFFFFF;  display: flex;  font-family: Phantomsans, sans-serif;  font-size: 20px;  justify-content: center;  line-height: 1em;  max-width: 100%;  min-width: 0px;  padding: 3px;  text-decoration: none;  user-select: none;  -webkit-user-select: none;  touch-action: manipulation;  white-space: nowrap;  cursor: pointer;}.button-64:active,.button-64:hover {  outline: 0;}.button-64 span {  background-color: rgb(5, 6, 45);  padding: 16px 24px;  border-radius: 6px;  width: 115px;  height: 60px;  transition: 300ms;}.button-64:hover span {  background: none;}&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>start_game</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;PAUSE&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>130</span>, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#34;height&#34;</span>, <span style=color:#e6db74>&#34;100px&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#34;.button-64 {  align-items: center;  background-image: linear-gradient(144deg,#AF40FF, #5B42F3 50%,#00DDEB);  border: 0;  border-radius: 8px;  box-shadow: rgba(151, 65, 252, 0.2) 0 15px 30px -5px;  box-sizing: border-box;  color: #FFFFFF;  display: flex;  font-family: Phantomsans, sans-serif;  font-size: 20px;  justify-content: center;  line-height: 1em;  max-width: 100%;  min-width: 0px;  padding: 3px;  text-decoration: none;  user-select: none;  -webkit-user-select: none;  touch-action: manipulation;  white-space: nowrap;  cursor: pointer;}.button-64:active,.button-64:hover {  outline: 0;}.button-64 span {  background-color: rgb(5, 6, 45);  padding: 16px 24px;  border-radius: 6px;  width: 80px;  height: 60px;  transition: 300ms;}.button-64:hover span {  background: none;}&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>pause_function</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noLoop</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>button_separation</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>score_buttons_width</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>300</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>score_buttons_height</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>score_button_display</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;SCORE: &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>actual_score</span>.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>score_button_display</span>.<span style=color:#a6e22e>position</span>((<span style=color:#a6e22e>width</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>score_buttons_width</span>) <span style=color:#f92672>-</span> <span style=color:#a6e22e>button_separation</span>, <span style=color:#a6e22e>button_separation</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>score_button_display</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#34;height&#34;</span>, <span style=color:#a6e22e>score_buttons_height</span>.<span style=color:#a6e22e>toString</span>() <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;px&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>score_button_display</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#34;.button-64 {  align-items: center;  background-image: linear-gradient(144deg,#AF40FF, #5B42F3 50%,#00DDEB);  border: 0;  border-radius: 8px;  box-shadow: rgba(151, 65, 252, 0.2) 0 15px 30px -5px;  box-sizing: border-box;  color: #FFFFFF;  display: flex;  font-family: Phantomsans, sans-serif;  font-size: 20px;  justify-content: center;  line-height: 1em;  max-width: 100%;  min-width: 140px;  padding: 3px;  text-decoration: none;  user-select: none;  -webkit-user-select: none;  touch-action: manipulation;  white-space: nowrap;  cursor: pointer;}.button-64:active,.button-64:hover {  outline: 0;}.button-64 span {  background-color: rgb(5, 6, 45);  padding: 16px 24px;  border-radius: 6px;  width: 100px;  height: 100px;  transition: 300ms;}.button-64:hover span {  background: none;}&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>high_score_button_display</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;HIGH_SCORE: &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>high_score</span>.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>high_score_button_display</span>.<span style=color:#a6e22e>position</span>((<span style=color:#a6e22e>width</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>125</span>) <span style=color:#f92672>-</span> <span style=color:#a6e22e>button_separation</span>, <span style=color:#a6e22e>button_separation</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>high_score_button_display</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#34;height&#34;</span>, <span style=color:#a6e22e>score_buttons_height</span>.<span style=color:#a6e22e>toString</span>() <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;px&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>high_score_button_display</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#34;.button-64 {  align-items: center;  background-image: linear-gradient(144deg,#AF40FF, #5B42F3 50%,#00DDEB);  border: 0;  border-radius: 8px;  box-shadow: rgba(151, 65, 252, 0.2) 0 15px 30px -5px;  box-sizing: border-box;  color: #FFFFFF;  display: flex;  font-family: Phantomsans, sans-serif;  font-size: 20px;  justify-content: center;  line-height: 1em;  max-width: 100%;  min-width: 140px;  padding: 3px;  text-decoration: none;  user-select: none;  -webkit-user-select: none;  touch-action: manipulation;  white-space: nowrap;  cursor: pointer;}.button-64:active,.button-64:hover {  outline: 0;}.button-64 span {  background-color: rgb(5, 6, 45);  padding: 16px 24px;  border-radius: 6px;  width: 100px;  height: 100px;  transition: 300ms;}.button-64:hover span {  background: none;}&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>restart</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gameMatrix</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>18</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>4</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gameMatrix</span>.<span style=color:#a6e22e>push</span>([...Array(<span style=color:#ae81ff>18</span>).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>)]);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gameMatrix</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> [...Array(<span style=color:#ae81ff>18</span>).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>9</span>)];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gameMatrix</span>[<span style=color:#ae81ff>18</span>] <span style=color:#f92672>=</span> [...Array(<span style=color:#ae81ff>18</span>).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>1</span>)];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>actual_score</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>high_score</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>high_score</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>actual_score</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>actual_score</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>next_token</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>loop</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// create a classic plane -&gt; h positive to go up ad
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>checkKeys</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>camera</span>(<span style=color:#a6e22e>camX</span>, <span style=color:#a6e22e>camY</span>, <span style=color:#a6e22e>camZ</span>, <span style=color:#a6e22e>centerX</span>, <span style=color:#a6e22e>centerY</span>, <span style=color:#a6e22e>centerZ</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>240</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>strokeWeight</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>texture</span>(<span style=color:#a6e22e>img</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>300</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sphere</span>(<span style=color:#ae81ff>650</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>h</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>h</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>gameMatrix</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>h</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>gameMatrix</span>[<span style=color:#a6e22e>h</span>].<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>display</span>(<span style=color:#a6e22e>h</span>, <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>gameMatrix</span>[<span style=color:#a6e22e>h</span>][<span style=color:#a6e22e>i</span>]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>current_token</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>current_token</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// print(h_token)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>display</span>(<span style=color:#a6e22e>mod</span>(<span style=color:#a6e22e>h_token</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>i</span>, <span style=color:#ae81ff>24</span>), <span style=color:#a6e22e>mod</span>(<span style=color:#a6e22e>i_token</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>j</span>, <span style=color:#ae81ff>18</span>), <span style=color:#a6e22e>current_token</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>score_button_display</span>.<span style=color:#a6e22e>html</span>(<span style=color:#e6db74>&#39;SCORE: &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>actual_score</span>.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>  <span style=color:#75715e>// score_button_display.position((width - score_buttons_width) - button_separation, button_separation);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>start_game</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gameMatrix</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>18</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>4</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gameMatrix</span>.<span style=color:#a6e22e>push</span>([...Array(<span style=color:#ae81ff>18</span>).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>)]);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>interval</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>setInterval</span>(<span style=color:#e6db74>&#39;move_down()&#39;</span>, <span style=color:#ae81ff>1000</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gameMatrix</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> [...Array(<span style=color:#ae81ff>18</span>).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>9</span>)];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gameMatrix</span>[<span style=color:#ae81ff>18</span>] <span style=color:#f92672>=</span> [...Array(<span style=color:#ae81ff>18</span>).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>1</span>)];
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>next_token</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>loop</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>pause_function</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isLooping</span>()) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>clearInterval</span>(<span style=color:#a6e22e>interval</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>noLoop</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>loop</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>interval</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>setInterval</span>(<span style=color:#e6db74>&#39;move_down()&#39;</span>, <span style=color:#ae81ff>1000</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>checkKeys</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>//To rotate the camera
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyIsDown</span>(<span style=color:#ae81ff>68</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>try_move</span>(<span style=color:#ae81ff>3</span>)) { <span style=color:#75715e>//Derecha
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>i_token</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cameraAngleRotation</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>20</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyIsDown</span>(<span style=color:#ae81ff>65</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>try_move</span>(<span style=color:#ae81ff>2</span>)) { <span style=color:#75715e>//Izquierda
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>i_token</span><span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cameraAngleRotation</span> <span style=color:#f92672>-=</span> <span style=color:#ae81ff>20</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyIsDown</span>(<span style=color:#ae81ff>83</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>move_down</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyIsDown</span>(<span style=color:#ae81ff>82</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>restart</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cameraAngleRotation</span> <span style=color:#f92672>%=</span> <span style=color:#ae81ff>360</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>camX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cos</span>(<span style=color:#a6e22e>cameraAngleRotation</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>cameraDistance</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>camZ</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sin</span>(<span style=color:#a6e22e>cameraAngleRotation</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>cameraDistance</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>rotate_token</span>(<span style=color:#a6e22e>clockwise</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>new_token</span> <span style=color:#f92672>=</span> Array();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>side</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>current_token</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>length</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>clockwise</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>side</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>new_token_row</span> <span style=color:#f92672>=</span> Array();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>side</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>--</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>new_token_row</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>current_token</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>]);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>new_token</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>new_token_row</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>side</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>--</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>new_token_row</span> <span style=color:#f92672>=</span> Array();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>side</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>new_token_row</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>current_token</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>]);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>new_token</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>new_token_row</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>current_token</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>current_token</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>new_token</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>] <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>gameMatrix</span>[<span style=color:#a6e22e>mod</span>(<span style=color:#a6e22e>h_token</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>i</span>, <span style=color:#ae81ff>24</span>)][<span style=color:#a6e22e>mod</span>(<span style=color:#a6e22e>i_token</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>j</span>, <span style=color:#ae81ff>18</span>)] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>current_token</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>new_token</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>move_down</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>try_move</span>(<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>h_token</span><span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>current_token</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>current_token</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>current_token</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>])
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>gameMatrix</span>[<span style=color:#a6e22e>mod</span>(<span style=color:#a6e22e>h_token</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>i</span>, <span style=color:#ae81ff>24</span>)][<span style=color:#a6e22e>mod</span>(<span style=color:#a6e22e>i_token</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>j</span>, <span style=color:#ae81ff>18</span>)] <span style=color:#f92672>=</span> <span style=color:#a6e22e>current_token</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>];
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>check_status</span>()) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>check_lines</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>next_token</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>check_status</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>18</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>actual_score</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>high_score</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>high_score</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>actual_score</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>gameMatrix</span>[<span style=color:#ae81ff>18</span>][<span style=color:#a6e22e>i</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>lose</span>()
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>lose</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>clearInterval</span>(<span style=color:#a6e22e>interval</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>18</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>gameMatrix</span>[<span style=color:#ae81ff>18</span>][<span style=color:#a6e22e>i</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// gameMatrix[18][i] = 10;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>display</span>(<span style=color:#ae81ff>18</span>, <span style=color:#a6e22e>i</span>, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noLoop</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>check_lines</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lines</span> <span style=color:#f92672>=</span> Array();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>gameMatrix</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cur_line</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>gameMatrix</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>gameMatrix</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>cur_line</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>cur_line</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>gameMatrix</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>length</span>){
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>lines</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>i</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>actual_score</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>100</span>;}
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>lines</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>idx</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>lines</span>[<span style=color:#a6e22e>i</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>idx</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>HEIGHT_GAME_MATRIX</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>gameMatrix</span>[<span style=color:#a6e22e>j</span>] <span style=color:#f92672>=</span> [...<span style=color:#a6e22e>gameMatrix</span>[<span style=color:#a6e22e>j</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>]];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gameMatrix</span>[<span style=color:#a6e22e>HEIGHT_GAME_MATRIX</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> [...Array(<span style=color:#ae81ff>18</span>).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>)]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gameMatrix</span>[<span style=color:#a6e22e>gameMatrix</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> [...Array(<span style=color:#ae81ff>18</span>).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>)]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>try_move</span>(<span style=color:#a6e22e>direction</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 1 down
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// 2 left
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// 3 right
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>sum</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>direction</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>current_token</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>current_token</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>current_token</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>] <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>gameMatrix</span>[<span style=color:#a6e22e>mod</span>(<span style=color:#a6e22e>h_token</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>24</span>)][<span style=color:#a6e22e>mod</span>(<span style=color:#a6e22e>i_token</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>j</span>, <span style=color:#ae81ff>18</span>)] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>sum</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>direction</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>current_token</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>current_token</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>current_token</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>] <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>gameMatrix</span>[<span style=color:#a6e22e>mod</span>(<span style=color:#a6e22e>h_token</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>i</span>, <span style=color:#ae81ff>24</span>)][<span style=color:#a6e22e>mod</span>(<span style=color:#a6e22e>i_token</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>18</span>)] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>sum</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>direction</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>current_token</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>current_token</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>gameMatrix</span>[<span style=color:#a6e22e>mod</span>(<span style=color:#a6e22e>h_token</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>i</span>, <span style=color:#ae81ff>24</span>)][<span style=color:#a6e22e>mod</span>(<span style=color:#a6e22e>i_token</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>18</span>)] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>current_token</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>] <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>sum</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>sum</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>display</span>(<span style=color:#a6e22e>h</span>, <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>color</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>color</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fill</span>(<span style=color:#a6e22e>colors</span>[<span style=color:#a6e22e>color</span>]);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>translate</span>(<span style=color:#a6e22e>cos</span>(<span style=color:#a6e22e>step</span> <span style=color:#f92672>*</span> (<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0</span>)) <span style=color:#f92672>*</span> <span style=color:#a6e22e>tetrisRadius</span>, (<span style=color:#a6e22e>h</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> (<span style=color:#a6e22e>height_step</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>), <span style=color:#a6e22e>sin</span>(<span style=color:#a6e22e>step</span> <span style=color:#f92672>*</span> (<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0</span>)) <span style=color:#f92672>*</span> <span style=color:#a6e22e>tetrisRadius</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>box</span>(<span style=color:#ae81ff>20</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>next_token</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>current_order</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>current_order</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>shuffle</span>(<span style=color:#a6e22e>tokens</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>current_token</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>current_order</span>.<span style=color:#a6e22e>pop</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>h_token</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>17</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>current_token</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// function mouseWheel(event) {
</span></span></span><span style=display:flex><span><span style=color:#75715e>//   cameraDistance += (event.delta / 10);
</span></span></span><span style=display:flex><span><span style=color:#75715e>// }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>keyPressed</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyCode</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>81</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rotate_token</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyCode</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>69</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rotate_token</span>(<span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></details><h2 id=results>Results
<a class=anchor href=#results>#</a></h2><p>As a result, we got a new 3D Tetris experience, which is entertaining and fun to play. The game is playable with the keyboard, and the player can rotate the game board and the falling blocks, and change the perspective of the game. You can check it out at the top of this article.</p><h2 id=conclusions--future-work>Conclusions & Future Work
<a class=anchor href=#conclusions--future-work>#</a></h2><p>The project was a success, and we got a new perspective of the classic game of Tetris, which is fun to play. It also shows how many different games that used to be played on a 2D screen can be adapted to a 3D environment, and how the game dynamics can be changed, and the game can be more entertaining, and get different variations of the original game.</p><p>In the future, we could add more features to the game, like a new menu and graphical interface, to start the game, and to end it. Pther multiple variations or game modes can be implemented too. We could also add a multiplayer mode, where the player can play against another player, or against the computer, and the game board could be bigger, and the blocks could fall faster, making the game more challenging.</p><p>Finally, it has been demostrated that, visual computings are not only useful, but also fun, and entertaining, and they can be used to create new experiences, and new ways to play games, and to have fun. The real limit of the possibilities of visual computing , modular arithmetics, linear algebra and many other topics, is the imagination of the people who use them.</p><h2 id=references>References
<a class=anchor href=#references>#</a></h2><ul><li><a href=https://en.wikipedia.org/wiki/Tetris>Tetris</a></li><li><a href=https://p5js.org/>p5.js</a></li><li><a href=https://visualcomputing.github.io/docs/>Homogenous Coordinates, Coordinate Spaces</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/Visual-Computing-2022-2/Talleres/commit/425086e8b740a946389325a05d27b1a8a9ae352e title='Last modified by dasilvaca | October 19, 2022' target=_blank rel=noopener><img src=/Talleres/svg/calendar.svg class=book-icon alt=Calendar>
<span>October 19, 2022</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#tetris-3d>Tetris 3D</a><ul><li><a href=#background>Background</a></li><li><a href=#the-game>The Game</a></li><li><a href=#implementation-details>Implementation details</a></li><li><a href=#results>Results</a></li><li><a href=#conclusions--future-work>Conclusions & Future Work</a></li><li><a href=#references>References</a></li></ul></li></ul></nav></div></aside></main></body></html>